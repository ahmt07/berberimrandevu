<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>Ahmet Tekeli Kuaför • Online Randevu</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  /* TAM EKRAN AÇIK GRİ CAM TEMA */
  --bg:#e5e7eb;       /* tüm ekran zemini */
  --ink:#111827;      /* ana yazı */
  --muted:#6b7280;    /* ikincil yazı */
  --brand:#d4af37;    /* altın */
  --danger:#ef4444;
  --ok:#10b981;
}

*{box-sizing:border-box;margin:0;padding:0}

html,body{
  font:15px/1.5 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);
  color:var(--ink);
}

/* === ARKA PLAN (TÜM EKRAN AÇIK GRİ + FLU FOTOĞRAF) === */
.bg{
  position:fixed;
  inset:0;
  z-index:-2;
  background:
    url("arka-plan.jpg") center/cover no-repeat,
    radial-gradient(circle at 10% 0%,rgba(148,163,184,.4),transparent 20%);
  filter:blur(10px);
}
.bg-overlay{
  position:fixed;
  inset:0;
  z-index:-1;
  /* tüm ekranı aydınlık yapan cam katman */
  background:
    linear-gradient(to bottom,rgba(255,255,255,.78),rgba(209,213,219,.95)),
    radial-gradient(circle at top,rgba(255,255,255,.6),transparent 55%);
}

/* === GENEL YERLEŞİM === */
body{
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:18px 10px 28px;
}

/* dış çerçeve – hafif cam */
.wrap{
  width:100%;
  max-width:420px;
  position:relative;
  border-radius:32px;
  padding:18px 16px 22px;
  background:linear-gradient(135deg,rgba(243,244,246,.8),rgba(229,231,235,.85));
  box-shadow:
    0 18px 55px rgba(15,23,42,.28),
    0 0 0 1px rgba(148,163,184,.35);
  backdrop-filter:blur(22px) saturate(140%);
}

/* === LOGO & ÜST BUTONLAR === */
.logo-wrap{
  display:flex;
  justify-content:center;
  margin-bottom:8px;
}
.logo-circle{
  width:86px;
  height:86px;
  border-radius:999px;
  background:url("logo.png") center/100% 100% no-repeat;
  box-shadow:0 18px 40px rgba(0,0,0,.35);
  border:4px solid rgba(248,250,251,.98);
}

/* üst sağ: admin & müşteri giriş */
.top-actions{
  position:absolute;
  top:12px;
  right:12px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.btn-top{
  border-radius:999px;
  padding:7px 13px;
  border:1px solid rgba(209,213,219,.9);
  cursor:pointer;
  font-size:12px;
  font-weight:600;
  background:rgba(255,255,255,.96);
  color:#111827;
  box-shadow:0 10px 26px rgba(15,23,42,.25);
  backdrop-filter:blur(18px);
}
.btn-top span{opacity:.95}

/* === ANA KART === */
.card{
  border-radius:26px;
  padding:16px 14px 18px;
  border:1px solid rgba(209,213,219,.95);
  background:linear-gradient(145deg,rgba(255,255,255,.98),rgba(243,244,246,.98));
  box-shadow:
    0 18px 40px rgba(15,23,42,.22),
    0 0 0 1px rgba(148,163,184,.25);
  color:var(--ink);
}

/* üst başlık */
.card-header{
  text-align:center;
  margin-bottom:14px;
}
.brand-title{
  font-size:24px;
  font-weight:800;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.brand-sub{
  margin-top:2px;
  font-size:11px;
  letter-spacing:.25em;
  text-transform:uppercase;
  color:var(--muted);
}
.rating{
  margin-top:8px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  background:rgba(255,255,255,.96);
  border:1px solid rgba(209,213,219,.95);
  box-shadow:0 10px 24px rgba(15,23,42,.2);
}
.rating .star{
  width:12px;
  height:12px;
  clip-path:polygon(50% 0%,63% 38%,100% 38%,69% 59%,82% 100%,50% 76%,18% 100%,31% 59%,0 38%,37% 38%);
  background:var(--brand);
}

/* === FORM GENEL === */
.section-title{
  font-size:12px;
  font-weight:600;
  margin:8px 0 4px;
  color:#111827;
}
.input,
.select,
.date-input{
  width:100%;
  border-radius:13px;
  padding:8px 11px;
  border:1px solid rgba(209,213,219,.95);
  background:linear-gradient(135deg,rgba(255,255,255,.99),rgba(249,250,251,.99));
  color:#0f172a;
  font-size:13px;
}
.input::placeholder{color:#9ca3af}

/* tarih kutusunu biraz ufalt */
.date-input{
  padding:6px 9px;
  font-size:10px;
}

.row{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.row > *{
  flex:1;
  min-width:0;
}

/* === BERBER SEÇİMİ – CHIPLER === */
.barber-choices{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.barber-chip{
  display:flex;
  align-items:center;
  gap:6px;
  padding:5px 9px;
  border-radius:999px;
  background:linear-gradient(135deg,rgba(243,244,246,1),rgba(229,231,235,1));
  border:1px solid rgba(209,213,219,1);
  cursor:pointer;
  font-size:11px;
  box-shadow:0 6px 14px rgba(15,23,42,.12);
}
.barber-chip.selected{
  background:linear-gradient(135deg,#fde68a,var(--brand));
  color:#111827;
  border-color:transparent;
}
.barber-avatar{
  width:24px;
  height:24px;
  border-radius:999px;
  overflow:hidden;
  flex-shrink:0;
  background:rgba(31,41,55,.08);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:700;
  text-transform:uppercase;
}
.barber-avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* === SAAT GRID === */
.slot-grid{
  margin-top:6px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:7px;
}
.slot{
  border-radius:12px;
  padding:7px 0;
  border:1px solid rgba(209,213,219,1);
  background:rgba(255,255,255,.99);
  color:#111827;
  font-weight:600;
  font-size:11px;
  cursor:pointer;
  box-shadow:0 10px 22px rgba(15,23,42,.15);
}
.slot.selected{
  background:linear-gradient(135deg,#fde68a,var(--brand));
  color:#111827;
  border-color:transparent;
}
.slot.disabled{
  opacity:.28;
  pointer-events:none;
}

/* === RANDEVU AL BUTONU === */
.btn-book{
  width:100%;
  margin-top:14px;
  border-radius:999px;
  padding:11px 18px;
  border:none;
  cursor:pointer;
  font-size:13px;
  font-weight:800;
  letter-spacing:.18em;
  text-transform:uppercase;
  background:linear-gradient(135deg,#fef3c7,#facc15,var(--brand));
  color:#111827;
  box-shadow:
    0 18px 42px rgba(0,0,0,.18),
    0 0 0 1px rgba(180,148,60,.55);
}

/* küçük açıklama */
.helper{
  margin-top:6px;
  font-size:11px;
  color:var(--muted);
}

/* === LİSTELER === */
.app-list{
  list-style:none;
  margin-top:4px;
}
.app-item{
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  gap:6px;
  padding:7px 7px;
  border-radius:13px;
  border:1px solid rgba(148,163,184,.7);
  background:radial-gradient(circle at top,rgba(15,23,42,.96),rgba(15,23,42,.98));
  font-size:11px;
  backdrop-filter:blur(14px);
  color:#e5e7eb;
}
.app-main{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.app-title{font-weight:600;}
.app-meta{color:#cbd5f5;}
.app-actions{
  display:flex;
  gap:5px;
  align-items:center;
}
.btn-mini{
  border-radius:999px;
  border:none;
  padding:4px 9px;
  font-size:10px;
  cursor:pointer;
  font-weight:600;
}
.btn-mini.edit{
  background:rgba(16,185,129,.12);
  color:var(--ok);
  border:1px solid rgba(16,185,129,.7);
}
.btn-mini.del{
  background:rgba(239,68,68,.12);
  color:var(--danger);
  border:1px solid rgba(248,113,113,.7);
}
.btn-mini.wp{
  background:rgba(34,197,94,.12);
  color:#22c55e;
  border:1px solid rgba(34,197,94,.7);
}
.btn-mini.note{
  background:rgba(59,130,246,.12);
  color:#60a5fa;
  border:1px solid rgba(59,130,246,.7);
}

/* panel */
.panel{
  margin-top:10px;
  background:radial-gradient(circle at top,rgba(15,23,42,.96),rgba(15,23,42,.99));
  border-radius:20px;
  padding:9px 9px 10px;
  border:1px solid rgba(148,163,184,.6);
  backdrop-filter:blur(16px);
  color:#e5e7eb;
}

/* === MODAL === */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.82);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:30;
}
.modal{
  width:100%;
  max-width:380px;
  background:radial-gradient(circle at top,rgba(15,23,42,.96),rgba(15,23,42,.99));
  border-radius:24px;
  padding:14px 14px 14px;
  border:1px solid rgba(148,163,184,.7);
  box-shadow:0 24px 70px rgba(0,0,0,.9);
  backdrop-filter:blur(22px);
  color:#e5e7eb;
}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.modal-title{font-size:14px;font-weight:700;}
.modal-close{
  border:none;
  background:none;
  color:#9ca3af;
  font-size:20px;
  cursor:pointer;
}

/* modal içi */
.tabs{
  display:flex;
  gap:6px;
  margin-bottom:10px;
}
.tab-btn{
  flex:1;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.7);
  background:rgba(15,23,42,.9);
  color:#9ca3af;
  padding:6px 0;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
}
.tab-btn.active{
  background:linear-gradient(135deg,#facc15,var(--brand));
  color:#111827;
  border-color:transparent;
}

.btn-full{
  width:100%;
  margin-top:9px;
  padding:9px 0;
  border-radius:999px;
  border:none;
  background:linear-gradient(135deg,#fef3c7,#facc15,var(--brand));
  color:#111827;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 14px 40px rgba(0,0,0,.85);
}

/* === ADMIN TABS === */
.admin-tabs{
  display:flex;
  flex-wrap:wrap;
  gap:5px;
  margin-bottom:9px;
}
.admin-tab{
  flex:1;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.7);
  background:rgba(15,23,42,.9);
  color:#9ca3af;
  padding:5px 0;
  font-size:11px;
  font-weight:600;
  cursor:pointer;
}
.admin-tab.active{
  background:linear-gradient(135deg,#facc15,var(--brand));
  color:#111827;
  border-color:transparent;
}
.admin-section{display:none;}
.admin-section.active{display:block;}

/* admin filtre satırı */
.admin-filter-row{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin:6px 0 10px;
}

/* kapanış günleri paneli */
.closed-panel-title{
  margin-top:10px;
  font-size:11px;
  font-weight:600;
  color:#e5e7eb;
}
.closed-date-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:4px 6px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.6);
  margin-top:4px;
  font-size:11px;
  color:#e5e7eb;
}
.closed-date-item span{color:#cbd5f5;}

/* === TOAST GELİŞMİŞ === */
.toast{
  position:fixed;
  left:50%;
  top:16px;
  transform:translateX(-50%);
  background:radial-gradient(circle at top,rgba(15,23,42,.96),rgba(15,23,42,.99));
  color:#f9fafb;
  padding:9px 14px;
  border-radius:999px;
  font-size:12px;
  border:1px solid rgba(148,163,184,.75);
  box-shadow:0 20px 50px rgba(0,0,0,.9);
  display:none;
  z-index:50;
  display:flex;
  align-items:center;
  gap:8px;
  backdrop-filter:blur(20px) saturate(150%);
  pointer-events:none;
  opacity:0;
}

.toast-dot{
  width:8px;
  height:8px;
  border-radius:999px;
  box-shadow:0 0 0 3px rgba(34,197,94,.35);
}

.toast.ok .toast-dot{
  background:#22c55e;
  box-shadow:0 0 0 4px rgba(34,197,94,.35);
}
.toast.err .toast-dot{
  background:#f97373;
  box-shadow:0 0 0 4px rgba(248,113,113,.4);
}

.toast-text{
  font-size:12px;
}

/* açılırken hafif pop animasyonu */
@keyframes toast-pop{
  0%{transform:translateX(-50%) translateY(-8px) scale(.9);opacity:0;}
  100%{transform:translateX(-50%) translateY(0) scale(1);opacity:1;}
}
.toast.show{
  opacity:1;
  animation:toast-pop .28s ease-out;
}

/* === BERBER ÇALIŞMA SAATİ MODAL === */
.schedule-wrapper{
  max-height:65vh;
  overflow:auto;
  padding-right:4px;
}
.schedule-row{
  border-radius:14px;
  border:1px solid rgba(148,163,184,.6);
  padding:6px 7px;
  margin-bottom:6px;
  background:radial-gradient(circle at top,rgba(15,23,42,.97),rgba(15,23,42,1));
}
.schedule-row-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:11px;
  margin-bottom:4px;
}
.schedule-day-name{
  font-weight:600;
}
.schedule-intervals{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-top:3px;
}
.schedule-interval{
  display:flex;
  gap:4px;
  align-items:center;
}
.schedule-interval select{
  flex:1;
  border-radius:10px;
  padding:4px 6px;
  border:1px solid rgba(148,163,184,.7);
  background:rgba(15,23,42,.95);
  color:#e5e7eb;
  font-size:11px;
}
.schedule-interval button{
  border:none;
  border-radius:999px;
  padding:3px 7px;
  font-size:10px;
  cursor:pointer;
  background:rgba(239,68,68,.12);
  color:var(--danger);
  border:1px solid rgba(248,113,113,.7);
}
.btn-add-interval{
  margin-top:4px;
  border-radius:999px;
  border:none;
  padding:3px 8px;
  font-size:10px;
  cursor:pointer;
  background:rgba(59,130,246,.12);
  color:#60a5fa;
  border:1px solid rgba(59,130,246,.7);
}

.day-active-label{
  font-size:10px;
  display:flex;
  align-items:center;
  gap:4px;
}
.day-active-label input{
  accent-color:var(--brand);
}

/* === RESPONSIVE === */
@media(max-width:480px){
  .wrap{
    padding:16px 10px 18px;
    border-radius:28px;
  }
  .card{
    padding:14px 10px 16px;
  }
  .brand-title{font-size:22px;}

  .slot-grid{
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:6px;
  }

  .date-input{
    font-size:11px;
    padding:5px 8px;
  }
}

/* büyük ekranda admin filtreleri yan yana */
@media(min-width:600px){
  .admin-filter-row{
    flex-direction:row;
    align-items:flex-end;
    gap:12px;
  }
}

/* === YAZDIRMA (PDF) MODU – aktif admin sekmesini yazdır === */
@media print{
  body{
    background:#ffffff;
    padding:0;
  }

  .bg,
  .bg-overlay,
  .wrap > .logo-wrap,
  .top-actions,
  .card,
  #customerModal,
  #scheduleModal,
  .toast{
    display:none !important;
  }

  #adminModal{
    position:static;
    display:block !important;
    background:#ffffff;
  }
  #adminModal .modal{
    max-width:100%;
    border:none;
    box-shadow:none;
    padding:10px;
    background:#ffffff;
  }

  #adminLoginArea{
    display:none !important;
  }
  #adminPanelArea{
    display:block !important;
    max-height:none;
    overflow:visible;
  }

  .admin-tabs{
    display:none !important;
  }

  .admin-section{
    display:none !important;
  }
  .admin-section.active{
    display:block !important;
  }

  .btn-full{
    display:none !important;
  }

  .app-item{
    box-shadow:none;
    border:1px solid #ddd;
    background:#fff;
    color:#000;
  }
  .app-title,
  .app-meta{
    color:#000;
  }
}
</style>
</head>
<body>
<div class="bg"></div>
<div class="bg-overlay"></div>

<div class="wrap">
  <div class="logo-wrap">
    <div class="logo-circle"></div>
  </div>

  <div class="top-actions">
    <button class="btn-top" type="button" id="btnAdminOpen">
      <span id="adminBtnLabel">Admin Girişi</span>
    </button>
    <button class="btn-top" type="button" id="btnCustomerOpen">
      <span id="customerBtnLabel">Müşteri Girişi</span>
    </button>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="brand-title">AHMET TEKELİ</div>
      <div class="brand-sub">ERKEK KUAFÖRÜ</div>
      <div class="rating">
        <div class="star"></div>
        <span>⭐️ONLİNE RANDEVU⭐️</span>
      </div>
    </div>

    <div>
      <div class="section-title">Ad Soyad</div>
      <input class="input" id="nameInput" placeholder="Adınız ve Soyadınız">

      <div class="section-title">Telefon</div>
      <input class="input" id="phoneInput" placeholder="05xxxxxxxxx">

      <div class="row">
        <div>
          <div class="section-title">Berber Seçimi</div>
          <div class="barber-choices" id="barberChoices"></div>
          <select class="select" id="barberSelect" style="display:none;"></select>
        </div>
        <div>
          <div class="section-title">İşlem Seçimi</div>
          <select class="select" id="serviceSelect"></select>
        </div>
      </div>

      <div class="section-title" style="margin-top:8px;">Tarih</div>
      <input type="date" class="date-input" id="dateInput">

      <div class="section-title" style="margin-top:8px;">Saat Seçimi</div>
      <div class="slot-grid" id="slotGrid"></div>

      <button class="btn-book" id="btnBook">RANDEVU AL</button>
      <div class="helper" id="bookingHelper">
        Randevu almak için önce müşteri girişi yapmalısın. Müşteri panelinden kayıt olabilirsin.
      </div>
      <div class="helper" id="dayInfoHelper"></div>
    </div>
  </div>
</div>

<!-- Müşteri Paneli Modal -->
<div class="modal-backdrop" id="customerModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Müşteri Paneli</div>
      <button class="modal-close" type="button" id="modalClose">&times;</button>
    </div>

    <div id="customerLoggedBox" style="display:none;">
      <div class="helper" id="customerLoggedText"></div>
      <div id="customerAppsBox" class="panel" style="margin-top:8px;display:none;">
        <div class="section-title">Randevularım</div>
        <ul class="app-list" id="appListModal"></ul>
      </div>
      <button class="btn-full" id="btnCustomerLogout" style="margin-top:8px;background:rgba(31,41,55,1);color:#f9fafb;">
        Çıkış Yap
      </button>
    </div>

    <div class="tabs" id="tabsRow">
      <button class="tab-btn active" type="button" data-tab="login">Giriş Yap</button>
      <button class="tab-btn" type="button" data-tab="register">Kayıt Ol</button>
    </div>

    <div id="loginTab">
      <div class="section-title">Telefon</div>
      <input class="input" id="loginPhone" placeholder="05xxxxxxxxx">
      <div class="section-title">Şifre</div>
      <input class="input" id="loginPass" type="password" placeholder="••••••">
      <button class="btn-full" id="btnLogin">Giriş Yap</button>
      <div class="helper">İlk defa geliyorsan üstten <b>Kayıt Ol</b> sekmesine geç.</div>
    </div>

    <div id="registerTab" style="display:none;">
      <div class="section-title">Ad Soyad</div>
      <input class="input" id="regName" placeholder="Adınız Soyadınız">
      <div class="section-title">Telefon</div>
      <input class="input" id="regPhone" placeholder="05xxxxxxxxx">
      <div class="section-title">Şifre</div>
      <input class="input" id="regPass" type="password" placeholder="En az 4 karakter">
      <button class="btn-full" id="btnRegister">Kayıt Ol</button>
      <div class="helper">Kayıt sonrası müşteri panelinden <b>Randevularım</b> kısmına erişirsin.</div>
    </div>
  </div>
</div>

<!-- Admin Panel Modal -->
<div class="modal-backdrop" id="adminModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Admin Paneli</div>
      <button class="modal-close" type="button" id="adminModalClose">&times;</button>
    </div>

    <div id="adminLoginArea">
      <div class="section-title">Telefon</div>
      <input class="input" id="adminPhone" placeholder="Admin telefon">
      <div class="section-title">Şifre</div>
      <input class="input" id="adminPass" type="password" placeholder="Şifre">
      <button class="btn-full" id="btnAdminLogin">Admin Giriş Yap</button>
      <div class="helper">Bu alan sadece işletme sahibi içindir.</div>
    </div>

    <div id="adminPanelArea" style="display:none;max-height:70vh;overflow:auto;padding-right:4px;">
      <div class="admin-tabs">
        <button class="admin-tab active" data-admin-section="adminSectionRapor">Raporlar</button>
        <button class="admin-tab" data-admin-section="adminSectionRandevu">Randevular</button>
        <button class="admin-tab" data-admin-section="adminSectionHizmet">Hizmet Yönetimi</button>
        <button class="admin-tab" data-admin-section="adminSectionBerber">Berber Yönetimi & Çalışma Saatleri</button>
      </div>

      <!-- RAPORLAR -->
      <div class="admin-section active" id="adminSectionRapor">
        <div class="section-title">Raporlar</div>
        <ul class="app-list" id="reportList"></ul>

        <button class="btn-full" id="btnPrintReports" style="margin-top:8px;">
          Raporları PDF Olarak Çıkar
        </button>
      </div>

      <!-- RANDEVU YÖNETİMİ -->
      <div class="admin-section" id="adminSectionRandevu">
        <div class="section-title">Randevu Yönetimi</div>
        <div class="admin-filter-row">
          <div>
            <div class="section-title">Tarih Filtresi</div>
            <input type="date" class="date-input" id="adminDateFilter">
          </div>
          <div>
            <div class="section-title">Berber Filtresi</div>
            <select class="select" id="adminBarberFilter"></select>
          </div>
        </div>
        <ul class="app-list" id="adminAppList"></ul>
        <div class="helper" id="adminCountInfo"></div>

        <button class="btn-full" id="btnPrintAppointments" style="margin-top:8px;">
          Randevu Listesini PDF Olarak Çıkar
        </button>

        <div class="closed-panel-title">Kapalı Günler (Özel tatil / dükkân kapalı)</div>
        <div class="row" style="margin-top:4px;">
          <input type="date" class="date-input" id="closedDateInput">
          <button class="btn-full" id="btnAddClosedDate" style="margin-top:0;">Kapalı Gün Ekle</button>
        </div>
        <div id="closedDateList"></div>
      </div>

      <!-- HİZMET YÖNETİMİ -->
      <div class="admin-section" id="adminSectionHizmet">
        <div class="section-title">Hizmet Yönetimi</div>
        <ul class="app-list" id="serviceList"></ul>
        <div class="row" style="margin-top:6px;">
          <input class="input" id="newServiceName" placeholder="Hizmet adı (Saç Kesim)">
          <input class="input" id="newServicePrice" type="number" min="0" step="10" placeholder="Fiyat">
          <input class="input" id="newServiceDuration" type="number" min="15" step="15" placeholder="Süre (dk)">
        </div>
        <button class="btn-full" id="btnAddService" style="margin-top:6px;">Hizmet Ekle</button>
      </div>

      <!-- BERBER YÖNETİMİ & ÇALIŞMA SAATLERİ -->
      <div class="admin-section" id="adminSectionBerber">
        <div class="section-title">Berber Yönetimi & Çalışma Saatleri</div>
        <ul class="app-list" id="barberList"></ul>

        <div class="section-title" style="margin-top:10px;">Yeni Berber</div>
        <input class="input" id="newBarberName" placeholder="Örn: Ahmet TEKELİ">
        <div class="section-title">Fotoğraf Yükle (isteğe bağlı)</div>
        <input class="input" id="newBarberPhotoFile" type="file" accept="image/*" style="padding:6px 10px;">
        <button class="btn-full" id="btnAddBarber" style="margin-top:6px;">Berber Ekle</button>
      </div>

      <button class="btn-full" id="btnAdminLogout" style="margin-top:14px;background:rgba(31,41,55,1);color:#f9fafb;">
        Admin Çıkış
      </button>
    </div>
  </div>
</div>

<!-- BERBER ÇALIŞMA SAATİ MODAL -->
<div class="modal-backdrop" id="scheduleModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="scheduleModalTitle">Çalışma Saatleri</div>
      <button class="modal-close" type="button" id="scheduleModalClose">&times;</button>
    </div>
    <div class="schedule-wrapper" id="scheduleWrapper"></div>
    <button class="btn-full" id="btnSaveSchedule">Çalışma Saatlerini Kaydet</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- JAVASCRIPT -->
<script type="module">
/* === FIREBASE === */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import {
  getFirestore,
  collection,
  doc,
  getDocs,
  setDoc,
  deleteDoc
} from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

/* --- SENİN YENİ FIREBASE PROJEN: randevularim-92ac2 --- */
const firebaseConfig = {
  apiKey: "AIzaSyD3S0XgKgNJLCJr3xQ-ASgr1gHz9MCou-4",
  authDomain: "randevularim-92ac2.firebaseapp.com",
  projectId: "randevularim-92ac2",
  storageBucket: "randevularim-92ac2.firebasestorage.app",
  messagingSenderId: "1092355095676",
  appId: "1:1092355095676:web:085921b2dff9d607b7ddf9"
};

const fbApp = initializeApp(firebaseConfig);
const db    = getFirestore(fbApp);

/* --- Firestore yardımcıları (Sadece RANDEVU için) --- */
async function loadAppointmentsFromFirestore(){
  try{
    const snap = await getDocs(collection(db,"appointments"));
    const arr = [];
    snap.forEach(d => {
      arr.push(d.data());
    });
    setAppointments(arr);
    renderAdminAppointments();
    renderMyAppointments();
    renderReports();
    renderSlots();
    console.log("Firestore'dan randevular yüklendi:", arr.length);
  }catch(err){
    console.error("Firestore randevu yükleme hatası:", err);
  }
}

async function saveAppointmentToFirestore(app){
  try{
    await setDoc(doc(db,"appointments", app.id), app);
    console.log("Randevu Firestore'a kaydedildi:", app.id);
  }catch(err){
    console.error("Randevu Firestore'a kaydedilirken hata:", err);
  }
}

async function deleteAppointmentFromFirestore(id){
  try{
    await deleteDoc(doc(db,"appointments", id));
    console.log("Randevu Firestore'dan silindi:", id);
  }catch(err){
    console.error("Randevu Firestore'dan silinirken hata:", err);
  }
}

/* === SABİTLER === */
const SLOT_TIMES = [
  "08:00","08:30","09:00","09:30",
  "10:00","10:30","11:00","11:30",
  "12:00","12:30","13:00","13:30",
  "14:00","14:30","15:00","15:30",
  "16:00","16:30","17:00","17:30",
  "18:00","18:30","19:00","19:30",
  "20:00","20:30","21:00","21:30",
  "22:00","22:30","23:00","23:30"
];

const ADMIN_PHONE = "05356749243";
const ADMIN_PASS  = "ahmetgs";
const MAX_DAYS_AHEAD = 30;
const DAY_NAMES = ["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"];

/* === DOM === */
const slotGrid  = document.getElementById("slotGrid");
const dateInput = document.getElementById("dateInput");
const btnBook   = document.getElementById("btnBook");
const nameInput = document.getElementById("nameInput");
const phoneInput= document.getElementById("phoneInput");
const barberSel = document.getElementById("barberSelect");
const barberChoicesEl = document.getElementById("barberChoices");
const servSel   = document.getElementById("serviceSelect");
const toastEl   = document.getElementById("toast");
const bookingHelper = document.getElementById("bookingHelper");
const dayInfoHelper = document.getElementById("dayInfoHelper");

/* hizmet / berber */
const serviceListEl  = document.getElementById("serviceList");
const newServiceNameEl  = document.getElementById("newServiceName");
const newServicePriceEl = document.getElementById("newServicePrice");
const newServiceDurationEl = document.getElementById("newServiceDuration");
const btnAddService  = document.getElementById("btnAddService");

const barberListEl   = document.getElementById("barberList");
const newBarberNameEl= document.getElementById("newBarberName");
const newBarberPhotoFileEl= document.getElementById("newBarberPhotoFile");
const btnAddBarber   = document.getElementById("btnAddBarber");

/* admin randevu */
const adminDateFilter   = document.getElementById("adminDateFilter");
const adminBarberFilter = document.getElementById("adminBarberFilter");
const adminAppList      = document.getElementById("adminAppList");
const adminCountInfo    = document.getElementById("adminCountInfo");
const reportListEl      = document.getElementById("reportList");

/* kapalı günler */
const closedDateInput   = document.getElementById("closedDateInput");
const btnAddClosedDate  = document.getElementById("btnAddClosedDate");
const closedDateList    = document.getElementById("closedDateList");

/* müşteri modal */
const customerModal      = document.getElementById("customerModal");
const btnCustomerOpen    = document.getElementById("btnCustomerOpen");
const modalClose         = document.getElementById("modalClose");
const tabBtns            = document.querySelectorAll(".tab-btn");
const loginTab           = document.getElementById("loginTab");
const registerTab        = document.getElementById("registerTab");
const btnLogin           = document.getElementById("btnLogin");
const btnRegister        = document.getElementById("btnRegister");
const customerLoggedBox  = document.getElementById("customerLoggedBox");
const customerLoggedText = document.getElementById("customerLoggedText");
const btnCustomerLogout  = document.getElementById("btnCustomerLogout");
const customerBtnLabel   = document.getElementById("customerBtnLabel");
const customerAppsBox    = document.getElementById("customerAppsBox");
const appListModal       = document.getElementById("appListModal");
const tabsRow            = document.getElementById("tabsRow");
const loginPhoneEl       = document.getElementById("loginPhone");
const loginPassEl        = document.getElementById("loginPass");
const regNameEl          = document.getElementById("regName");
const regPhoneEl         = document.getElementById("regPhone");
const regPassEl          = document.getElementById("regPass");

/* admin modal */
const adminModalEl     = document.getElementById("adminModal");
const btnAdminOpen     = document.getElementById("btnAdminOpen");
const adminModalClose  = document.getElementById("adminModalClose");
const adminLoginArea   = document.getElementById("adminLoginArea");
const adminPanelArea   = document.getElementById("adminPanelArea");
const btnAdminLogin    = document.getElementById("btnAdminLogin");
const btnAdminLogout   = document.getElementById("btnAdminLogout");
const adminBtnLabel    = document.getElementById("adminBtnLabel");
const adminTabBtns     = document.querySelectorAll(".admin-tab");
const adminSections    = document.querySelectorAll(".admin-section");
const adminPhoneEl     = document.getElementById("adminPhone");
const adminPassEl      = document.getElementById("adminPass");

/* çalışma saati modal */
const scheduleModal    = document.getElementById("scheduleModal");
const scheduleModalTitle = document.getElementById("scheduleModalTitle");
const scheduleModalClose = document.getElementById("scheduleModalClose");
const scheduleWrapper  = document.getElementById("scheduleWrapper");
const btnSaveSchedule  = document.getElementById("btnSaveSchedule");

/* PDF butonları */
const btnPrintReports = document.getElementById("btnPrintReports");
const btnPrintAppointments = document.getElementById("btnPrintAppointments");

/* STATE */
let services = [];
let barbers = [];
let appointments = [];
let customers = [];
let closedDates = [];
let currentCustomer = null;
let isAdminLogged = false;
let currentScheduleBarberId = null;
let selectedTime = null;
let editingId = null;

/* === YARDIMCI === */
function showToast(msg,type="ok"){
  // ikon seç
  const icon = type==="ok" ? "✅" : "⚠️";

  toastEl.className = "toast "+type;
  toastEl.innerHTML = `
    <span class="toast-dot"></span>
    <div class="toast-text"><strong>${icon}</strong> ${msg}</div>
  `;

  toastEl.style.display="flex";
  // animasyonu resetlemek için
  void toastEl.offsetWidth;
  toastEl.classList.add("show");

  if (navigator.vibrate){
    navigator.vibrate(80);
  }

  setTimeout(()=>{
    toastEl.classList.remove("show");
    setTimeout(()=>{toastEl.style.display="none";},180);
  },2600);
}

function timeToMin(t){
  const [h,m] = t.split(":").map(Number);
  return h*60 + m;
}
function minToTime(m){
  const h = Math.floor(m/60);
  const mm = m%60;
  return `${String(h).padStart(2,"0")}:${String(mm).padStart(2,"0")}`;
}

function saveToLS(key, value){
  localStorage.setItem(key, JSON.stringify(value));
}
function loadFromLS(key, fallback){
  const raw = localStorage.getItem(key);
  if(!raw) return fallback;
  try{return JSON.parse(raw);}catch{ return fallback;}
}

/* varsayılan hizmet ve berberler */
function seedDefaults(){
  if(!services.length){
    services = [
      {id:"svc-sac", name:"Saç Kesim", price:250, duration:30},
      {id:"svc-sac-sakal", name:"Saç + Sakal", price:400, duration:60},
      {id:"svc-sakal", name:"Sakal", price:200, duration:30},
      {id:"svc-cocuk", name:"Çocuk Saç", price:200, duration:30}
    ];
  }
  if(!barbers.length){
    const baseSchedule = [
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]}, // Pzt
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:false, intervals:[]} // Pazar
    ];
    barbers = [
      {id:"brb-ahmet", name:"Ahmet TEKELİ", photo:null, schedule:JSON.parse(JSON.stringify(baseSchedule))},
      {id:"brb-cırak", name:"Çırak", photo:null, schedule:JSON.parse(JSON.stringify(baseSchedule))}
    ];
  }
}

/* === STATE YÜKLE / KAYDET === */
function loadState(){
  services     = loadFromLS("atk_services",[]);
  barbers      = loadFromLS("atk_barbers",[]);
  appointments = loadFromLS("atk_appointments",[]);
  customers    = loadFromLS("atk_customers",[]);
  closedDates  = loadFromLS("atk_closedDates",[]);
  seedDefaults();

  const curPhone = localStorage.getItem("atk_currentCustomerPhone");
  if(curPhone){
    currentCustomer = customers.find(c=>c.phone===curPhone) || null;
  }
  isAdminLogged = localStorage.getItem("atk_isAdminLogged")==="1";
}

function saveServices(){saveToLS("atk_services",services);}
function saveBarbers(){saveToLS("atk_barbers",barbers);}
function saveAppointments(){saveToLS("atk_appointments",appointments);}
function saveCustomers(){saveToLS("atk_customers",customers);}
function saveClosedDates(){saveToLS("atk_closedDates",closedDates);}

/* Firestore'dan gelen randevuları state'e bas */
function setAppointments(arr){
  appointments = Array.isArray(arr)?arr:[];
  appointments.sort((a,b)=>{
    const da = (a.date||"") + " " + (a.time||"");
    const db = (b.date||"") + " " + (b.time||"");
    return da.localeCompare(db);
  });
  saveAppointments();
}

/* === UI RENDER === */
function renderServicesSelect(){
  servSel.innerHTML="";
  services.forEach(s=>{
    const opt=document.createElement("option");
    opt.value=s.id;
    opt.textContent = `${s.name} (${s.duration} dk)`;
    servSel.appendChild(opt);
  });
}

/* HİZMET LİSTESİ (SİLME İLE) */
function renderServiceList(){
  serviceListEl.innerHTML = "";

  if(!services.length){
    const li = document.createElement("li");
    li.className = "app-item";
    li.textContent = "Henüz hizmet eklenmemiş.";
    serviceListEl.appendChild(li);
    return;
  }

  services.forEach(s=>{
    const li = document.createElement("li");
    li.className = "app-item";

    const main = document.createElement("div");
    main.className = "app-main";

    const title = document.createElement("div");
    title.className = "app-title";
    title.textContent = s.name;

    const meta = document.createElement("div");
    meta.className = "app-meta";
    meta.textContent = `Süre: ${s.duration||0} dk • Fiyat: ${Number(s.price||0)} ₺`;

    main.appendChild(title);
    main.appendChild(meta);

    const acts = document.createElement("div");
    acts.className = "app-actions";

    const btnDel = document.createElement("button");
    btnDel.className = "btn-mini del";
    btnDel.textContent = "Sil";
    btnDel.addEventListener("click",()=>{
      if(!confirm(`${s.name} hizmetini silmek istediğine emin misin?`)) return;
      services = services.filter(x=>x.id!==s.id);
      saveServices();
      renderServiceList();
      renderServicesSelect();
      renderSlots();
      showToast("Hizmet silindi.","ok");
    });

    acts.appendChild(btnDel);

    li.appendChild(main);
    li.appendChild(acts);
    serviceListEl.appendChild(li);
  });
}

function renderBarbersUI(){
  // ana form içi chip + select
  barberChoicesEl.innerHTML="";
  barberSel.innerHTML="";
  barbers.forEach((b,idx)=>{
    const opt=document.createElement("option");
    opt.value=b.id;
    opt.textContent=b.name;
    barberSel.appendChild(opt);

    const chip=document.createElement("button");
    chip.type="button";
    chip.className="barber-chip";
    chip.dataset.id=b.id;

    const av=document.createElement("div");
    av.className="barber-avatar";
    if(b.photo){
      const img=document.createElement("img");
      img.src=b.photo;
      av.appendChild(img);
    }else{
      av.textContent = b.name.split(" ").map(p=>p[0]).join("").toUpperCase();
    }

    const span=document.createElement("span");
    span.textContent=b.name;

    chip.appendChild(av);
    chip.appendChild(span);
    chip.addEventListener("click",()=>{
      barberSel.value=b.id;
      renderBarberChipsSelected();
      renderSlots();
    });

    barberChoicesEl.appendChild(chip);
  });

  // admin filtre berber select
  adminBarberFilter.innerHTML="";
  const optAll=document.createElement("option");
  optAll.value="";
  optAll.textContent="Tüm Berberler";
  adminBarberFilter.appendChild(optAll);
  barbers.forEach(b=>{
    const o=document.createElement("option");
    o.value=b.id;
    o.textContent=b.name;
    adminBarberFilter.appendChild(o);
  });

  // seçili barber default
  if(barbers.length && !barberSel.value){
    barberSel.value=barbers[0].id;
  }
  renderBarberChipsSelected();

  // admin berber listesi
  renderBarberListAdmin();
}

function renderBarberChipsSelected(){
  const currentId = barberSel.value;
  document.querySelectorAll(".barber-chip").forEach(ch=>{
    ch.classList.toggle("selected", ch.dataset.id===currentId);
  });
}

function renderClosedDates(){
  closedDateList.innerHTML="";
  closedDates.sort();
  closedDates.forEach(d=>{
    const row=document.createElement("div");
    row.className="closed-date-item";
    const span=document.createElement("span");
    span.textContent=d;
    const btn=document.createElement("button");
    btn.className="btn-mini del";
    btn.textContent="Sil";
    btn.addEventListener("click",()=>{
      closedDates = closedDates.filter(x=>x!==d);
      saveClosedDates();
      renderClosedDates();
      renderSlots();
    });
    row.appendChild(span);
    row.appendChild(btn);
    closedDateList.appendChild(row);
  });
}

function renderSlots(){
  slotGrid.innerHTML="";
  dayInfoHelper.textContent="";

  const dateStr = dateInput.value;
  const barberId = barberSel.value;
  const svcId = servSel.value;
  if(!dateStr || !barberId || !svcId) return;

  // kapalı gün kontrol
  if(closedDates.includes(dateStr)){
    dayInfoHelper.textContent="Bu tarih kapalı gün olarak işaretlenmiş. Randevu alınamaz.";
    return;
  }

  const barber = barbers.find(b=>b.id===barberId);
  const service = services.find(s=>s.id===svcId);
  if(!barber || !service) return;

  const d = new Date(dateStr+"T00:00:00");
  const jsDay = d.getDay();
  const idx = (jsDay+6)%7; // Pzt=0...
  const daySchedule = barber.schedule && barber.schedule[idx] ? barber.schedule[idx] : {active:false, intervals:[]};

  if(!daySchedule.active || !daySchedule.intervals.length){
    dayInfoHelper.textContent="Bu gün için çalışma saati tanımlı değil.";
    return;
  }

  const todaysApps = appointments.filter(a=>a.date===dateStr && a.barberId===barberId);
  const serviceMin = service.duration || 30;

  SLOT_TIMES.forEach(time=>{
    const slotStart = timeToMin(time);
    const slotEnd30 = slotStart + 30;

    const inWorking = daySchedule.intervals.some(int=>{
      const s=timeToMin(int.start);
      const e=timeToMin(int.end);
      return slotStart>=s && slotEnd30<=e;
    });
    if(!inWorking) return;

    const newStart = slotStart;
    const newEnd   = newStart + serviceMin;

    let disabled=false;
    for(const a of todaysApps){
      if(editingId && a.id===editingId) continue;
      const aStart=timeToMin(a.time);
      const aEnd  =aStart + (a.duration || 30);
      if(newStart < aEnd && aStart < newEnd){
        disabled=true;
        break;
      }
    }

    const btn=document.createElement("button");
    btn.type="button";
    btn.textContent=time;
    btn.className="slot";
    if(disabled) btn.classList.add("disabled");
    if(selectedTime===time) btn.classList.add("selected");

    if(!disabled){
      btn.addEventListener("click",()=>{
        selectedTime=time;
        renderSlots();
      });
    }

    slotGrid.appendChild(btn);
  });

  if(!slotGrid.children.length){
    dayInfoHelper.textContent="Bu gün için uygun zaman aralığı bulunamadı.";
  }else{
    if(serviceMin>30){
      dayInfoHelper.textContent = `Seçtiğin işlem süresi: ${serviceMin} dk. Tüm süre boyunca çakışma olmayacak slotlar gösterildi.`;
    }else{
      dayInfoHelper.textContent="";
    }
  }
}

/* müşteri paneli randevular */
function renderMyAppointments(){
  if(!currentCustomer){
    customerAppsBox.style.display="none";
    appListModal.innerHTML="";
    return;
  }
  const my = appointments.filter(a=>a.customerPhone===currentCustomer.phone);
  if(!my.length){
    customerAppsBox.style.display="none";
    appListModal.innerHTML="";
    return;
  }
  customerAppsBox.style.display="block";

  my.sort((a,b)=>{
    const da = (a.date||"")+" "+(a.time||"");
    const db = (b.date||"")+" "+(b.time||"");
    return da.localeCompare(db);
  });

  appListModal.innerHTML="";
  my.forEach(a=>{
    const li=document.createElement("li");
    li.className="app-item";

    const main=document.createElement("div");
    main.className="app-main";
    const svc=services.find(s=>s.id===a.serviceId);
    const brb=barbers.find(b=>b.id===a.barberId);
    const title=document.createElement("div");
    title.className="app-title";
    title.textContent = `${a.date} • ${a.time} • ${svc?svc.name:"İşlem"} (${brb?brb.name:"Berber"})`;
    const meta=document.createElement("div");
    meta.className="app-meta";
    meta.textContent = `${a.name} – ${a.phone}`;
    main.appendChild(title);
    main.appendChild(meta);

    const acts=document.createElement("div");
    acts.className="app-actions";

    const btnEdit=document.createElement("button");
    btnEdit.className="btn-mini edit";
    btnEdit.textContent="Düzenle";
    btnEdit.addEventListener("click",()=>startEditAppointment(a.id));

    const btnDel=document.createElement("button");
    btnDel.className="btn-mini del";
    btnDel.textContent="İptal";
    btnDel.addEventListener("click",()=>deleteAppointment(a.id));

    const btnWp=document.createElement("button");
    btnWp.className="btn-mini wp";
    btnWp.textContent="WhatsApp";
    btnWp.addEventListener("click",()=>openWhatsAppForAppointment(a));

    acts.appendChild(btnEdit);
    acts.appendChild(btnDel);
    acts.appendChild(btnWp);

    li.appendChild(main);
    li.appendChild(acts);
    appListModal.appendChild(li);
  });
}

/* admin randevu listesi */
function renderAdminAppointments(){
  adminAppList.innerHTML="";
  let list = [...appointments];

  const df = adminDateFilter.value;
  const bf = adminBarberFilter.value;
  if(df) list = list.filter(a=>a.date===df);
  if(bf) list = list.filter(a=>a.barberId===bf);

  list.sort((a,b)=>{
    const da = (a.date||"")+" "+(a.time||"");
    const db = (b.date||"")+" "+(b.time||"");
    return da.localeCompare(db);
  });

  list.forEach(a=>{
    const li=document.createElement("li");
    li.className="app-item";

    const svc=services.find(s=>s.id===a.serviceId);
    const brb=barbers.find(b=>b.id===a.barberId);

    const main=document.createElement("div");
    main.className="app-main";
    const title=document.createElement("div");
    title.className="app-title";
    title.textContent = `${a.date} • ${a.time} • ${svc?svc.name:"İşlem"} (${brb?brb.name:"Berber"})`;
    const meta=document.createElement("div");
    meta.className="app-meta";
    meta.textContent = `${a.name} – ${a.phone} • Süre: ${a.duration||30} dk`;
    main.appendChild(title);
    main.appendChild(meta);

    const acts=document.createElement("div");
    acts.className="app-actions";

    const btnEdit=document.createElement("button");
    btnEdit.className="btn-mini edit";
    btnEdit.textContent="Düzenle";
    btnEdit.addEventListener("click",()=>startEditAppointment(a.id));

    const btnDel=document.createElement("button");
    btnDel.className="btn-mini del";
    btnDel.textContent="Sil";
    btnDel.addEventListener("click",()=>deleteAppointment(a.id));

    const btnWp=document.createElement("button");
    btnWp.className="btn-mini wp";
    btnWp.textContent="WhatsApp";
    btnWp.addEventListener("click",()=>openWhatsAppForAppointment(a));

    acts.appendChild(btnEdit);
    acts.appendChild(btnDel);
    acts.appendChild(btnWp);

    li.appendChild(main);
    li.appendChild(acts);
    adminAppList.appendChild(li);
  });

  adminCountInfo.textContent = `${list.length} adet randevu listelendi.`;
}

/* raporlar */
function renderReports(){
  reportListEl.innerHTML="";
  if(!appointments.length){
    const li=document.createElement("li");
    li.className="app-item";
    li.textContent="Henüz randevu kaydı yok.";
    reportListEl.appendChild(li);
    return;
  }

  const map = {};
  appointments.forEach(a=>{
    if(!a.date) return;
    if(!map[a.date]) map[a.date]={count:0,total:0};
    map[a.date].count++;
    const svc=services.find(s=>s.id===a.serviceId);
    const price=svc?Number(svc.price||0):0;
    map[a.date].total += price;
  });

  const dates = Object.keys(map).sort();
  dates.forEach(d=>{
    const li=document.createElement("li");
    li.className="app-item";

    const main=document.createElement("div");
    main.className="app-main";
    const t=document.createElement("div");
    t.className="app-title";
    t.textContent=d;
    const m=document.createElement("div");
    m.className="app-meta";
    m.textContent=`Toplam Randevu: ${map[d].count} • Tahmini Ciro: ${map[d].total} ₺`;
    main.appendChild(t);
    main.appendChild(m);

    li.appendChild(main);
    reportListEl.appendChild(li);
  });
}

/* admin berber listesi */
function renderBarberListAdmin(){
  barberListEl.innerHTML="";
  barbers.forEach(b=>{
    const li=document.createElement("li");
    li.className="app-item";

    const main=document.createElement("div");
    main.className="app-main";
    const t=document.createElement("div");
    t.className="app-title";
    t.textContent=b.name;
    const m=document.createElement("div");
    m.className="app-meta";
    m.textContent="Çalışma saatlerini düzenlemek için alttaki butonu kullan.";
    main.appendChild(t);
    main.appendChild(m);

    const acts=document.createElement("div");
    acts.className="app-actions";

    const btnSched=document.createElement("button");
    btnSched.className="btn-mini note";
    btnSched.textContent="Saat Ayarla";
    btnSched.addEventListener("click",()=>openScheduleModal(b.id));

    const btnDel=document.createElement("button");
    btnDel.className="btn-mini del";
    btnDel.textContent="Sil";
    btnDel.addEventListener("click",()=>{
      if(!confirm("Bu berberi silmek istediğine emin misin? Bu berbere bağlı randevular listede kalır, ancak berber adı boş görünür.")) return;
      barbers = barbers.filter(x=>x.id!==b.id);
      saveBarbers();
      renderBarbersUI();
      renderSlots();
      renderAdminAppointments();
    });

    acts.appendChild(btnSched);
    acts.appendChild(btnDel);

    li.appendChild(main);
    li.appendChild(acts);
    barberListEl.appendChild(li);
  });
}

/* müşteri paneli genel UI */
function updateCustomerUI(){
  if(currentCustomer){
    customerLoggedBox.style.display="block";
    tabsRow.style.display="none";
    loginTab.style.display="none";
    registerTab.style.display="none";
    customerLoggedText.textContent = `Hoş geldin ${currentCustomer.name}. Kayıtlı telefonun: ${currentCustomer.phone}`;
    customerBtnLabel.textContent="Müşteri Paneli (Açık)";
    bookingHelper.textContent="Hoş geldin, yukarıdan berberini, işlemini ve saatini seçip randevunu alabilirsin.";
  }else{
    customerLoggedBox.style.display="none";
    tabsRow.style.display="flex";
    loginTab.style.display="block";
    registerTab.style.display="none";
    document.querySelector('.tab-btn[data-tab="login"]').classList.add("active");
    document.querySelector('.tab-btn[data-tab="register"]').classList.remove("active");
    customerBtnLabel.textContent="Müşteri Girişi";
    bookingHelper.textContent="Randevu almak için önce müşteri girişi yapmalısın. Müşteri panelinden kayıt olabilirsin.";
  }
}

/* admin panel genel UI */
function updateAdminUI(){
  if(isAdminLogged){
    adminLoginArea.style.display="none";
    adminPanelArea.style.display="block";
    adminBtnLabel.textContent="Admin Paneli (Açık)";
  }else{
    adminLoginArea.style.display="block";
    adminPanelArea.style.display="none";
    adminBtnLabel.textContent="Admin Girişi";
  }
}

/* === RANDEVU CRUD === */
function validatePhone(p){
  const v = p.trim();
  return /^05\d{9}$/.test(v);
}

async function deleteAppointment(id){
  if(!confirm("Randevuyu silmek istediğine emin misin?")) return;
  appointments = appointments.filter(a=>a.id!==id);
  saveAppointments();
  renderAdminAppointments();
  renderMyAppointments();
  renderReports();
  renderSlots();
  await deleteAppointmentFromFirestore(id);
  showToast("Randevu silindi.","ok");
}

function startEditAppointment(id){
  const a = appointments.find(x=>x.id===id);
  if(!a) return;
  editingId = id;

  nameInput.value = a.name;
  phoneInput.value = a.phone;
  dateInput.value = a.date;
  barberSel.value = a.barberId;
  servSel.value = a.serviceId;
  selectedTime = a.time;
  renderBarberChipsSelected();
  renderSlots();

  showToast("Randevu formda. Düzenleyip tekrar kaydedebilirsin.","ok");
  customerModal.style.display="none";
  adminModalEl.style.display="none";
  window.scrollTo({top:0,behavior:"smooth"});
}

function openWhatsAppForAppointment(a){
  const tel = (a.phone||"").replace(/\D/g,"");
  if(tel.length<10){
    showToast("Geçersiz telefon numarası.","err");
    return;
  }
  let national = tel;
  if(national.startsWith("0")) national = national.slice(1);
  const svc=services.find(s=>s.id===a.serviceId);
  const brb=barbers.find(b=>b.id===a.barberId);
  const msg = `Merhaba ${a.name},\n\nAhmet Tekeli Erkek Kuaförü'nden yazıyorum.\n\n${a.date} tarihinde ${a.time} için ${svc?svc.name:"işlemin"} (${a.duration||30} dk) randevun bulunuyor.\nBerber: ${brb?brb.name:"-"}\n\nGörüşmek üzere.`;
  const url = `https://wa.me/90${national}?text=${encodeURIComponent(msg)}`;
  window.open(url,"_blank");
}

/* === ÇALIŞMA SAATİ MODALI === */
function buildScheduleRow(dayIndex, dayData){
  const row=document.createElement("div");
  row.className="schedule-row";
  row.dataset.dayIndex = String(dayIndex);

  const head=document.createElement("div");
  head.className="schedule-row-head";

  const nameDiv=document.createElement("div");
  nameDiv.className="schedule-day-name";
  nameDiv.textContent=DAY_NAMES[dayIndex];

  const label=document.createElement("label");
  label.className="day-active-label";
  const cb=document.createElement("input");
  cb.type="checkbox";
  cb.checked = dayData.active;
  const span=document.createElement("span");
  span.textContent="Açık";
  label.appendChild(cb);
  label.appendChild(span);

  head.appendChild(nameDiv);
  head.appendChild(label);

  const intervalsWrap=document.createElement("div");
  intervalsWrap.className="schedule-intervals";

  function addIntervalRow(intData){
    const intDiv=document.createElement("div");
    intDiv.className="schedule-interval";

    const selStart=document.createElement("select");
    const selEnd=document.createElement("select");
    [selStart,selEnd].forEach(sel=>{
      SLOT_TIMES.forEach(t=>{
        const opt=document.createElement("option");
        opt.value=t;
        opt.textContent=t;
        sel.appendChild(opt);
      });
    });
    selStart.value=intData.start;
    selEnd.value=intData.end;

    const delBtn=document.createElement("button");
    delBtn.type="button";
    delBtn.textContent="Sil";
    delBtn.addEventListener("click",()=>intDiv.remove());

    intDiv.appendChild(selStart);
    intDiv.appendChild(selEnd);
    intDiv.appendChild(delBtn);
    intervalsWrap.appendChild(intDiv);
  }

  if(dayData.intervals && dayData.intervals.length){
    dayData.intervals.forEach(i=>addIntervalRow(i));
  }

  const addBtn=document.createElement("button");
  addBtn.type="button";
  addBtn.className="btn-add-interval";
  addBtn.textContent="Saat Aralığı Ekle";
  addBtn.addEventListener("click",()=>{
    addIntervalRow({start:"09:00", end:"20:00"});
  });

  row.appendChild(head);
  row.appendChild(intervalsWrap);
  row.appendChild(addBtn);

  return row;
}

function openScheduleModal(barberId){
  const barber = barbers.find(b=>b.id===barberId);
  if(!barber) return;
  currentScheduleBarberId = barberId;
  scheduleModalTitle.textContent = `${barber.name} • Çalışma Saatleri`;

  if(!barber.schedule || !Array.isArray(barber.schedule) || barber.schedule.length!==7){
    barber.schedule = [
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:false, intervals:[]}
    ];
  }

  scheduleWrapper.innerHTML="";
  barber.schedule.forEach((d,i)=>{
    scheduleWrapper.appendChild(buildScheduleRow(i,d));
  });

  scheduleModal.style.display="flex";
}

function saveScheduleFromModal(){
  if(!currentScheduleBarberId) return;
  const barber = barbers.find(b=>b.id===currentScheduleBarberId);
  if(!barber) return;

  const rows=[...scheduleWrapper.querySelectorAll(".schedule-row")];
  const newSchedule = rows.map(row=>{
    const active = row.querySelector('.day-active-label input').checked;
    const intervals = [];
    row.querySelectorAll(".schedule-interval").forEach(div=>{
      const selects = div.querySelectorAll("select");
      if(selects.length<2) return;
      const s=selects[0].value;
      const e=selects[1].value;
      if(s && e && timeToMin(e)>timeToMin(s)){
        intervals.push({start:s,end:e});
      }
    });
    return {active, intervals};
  });

  barber.schedule = newSchedule;
  saveBarbers();
  renderSlots();
  scheduleModal.style.display="none";
  currentScheduleBarberId=null;
  showToast("Çalışma saatleri kaydedildi.","ok");
}

/* === EVENTLER === */
btnSaveSchedule.addEventListener("click",saveScheduleFromModal);
scheduleModalClose.addEventListener("click",()=>{scheduleModal.style.display="none"; currentScheduleBarberId=null;});

/* müşteri modal açık/kapalı */
btnCustomerOpen.addEventListener("click",()=>{
  updateCustomerUI();
  renderMyAppointments();
  customerModal.style.display="flex";
});
modalClose.addEventListener("click",()=>customerModal.style.display="none");

/* müşteri login/register sekmeleri */
tabBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    tabBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const tab=btn.dataset.tab;
    if(tab==="login"){
      loginTab.style.display="block";
      registerTab.style.display="none";
    }else{
      loginTab.style.display="none";
      registerTab.style.display="block";
    }
  });
});

/* müşteri kayıt */
btnRegister.addEventListener("click",()=>{
  const name=regNameEl.value.trim();
  const phone=regPhoneEl.value.trim();
  const pass=regPassEl.value.trim();

  if(!name){showToast("Ad soyad zorunlu.","err");return;}
  if(!validatePhone(phone)){showToast("Telefon formatı 05xxxxxxxxx olmalı.","err");return;}
  if(pass.length<4){showToast("Şifre en az 4 karakter olmalı.","err");return;}

  if(customers.some(c=>c.phone===phone)){
    showToast("Bu telefon ile zaten kayıt var, giriş yap.","err");
    return;
  }

  const c={phone,name,pass};
  customers.push(c);
  saveCustomers();
  currentCustomer=c;
  localStorage.setItem("atk_currentCustomerPhone",phone);
  updateCustomerUI();
  renderMyAppointments();
  showToast("Kayıt tamamlandı.","ok");
});

/* müşteri giriş */
btnLogin.addEventListener("click",()=>{
  const phone=loginPhoneEl.value.trim();
  const pass=loginPassEl.value.trim();
  if(!validatePhone(phone)){showToast("Telefon formatı 05xxxxxxxxx olmalı.","err");return;}
  const c = customers.find(x=>x.phone===phone && x.pass===pass);
  if(!c){showToast("Telefon veya şifre hatalı.","err");return;}
  currentCustomer=c;
  localStorage.setItem("atk_currentCustomerPhone",phone);
  updateCustomerUI();
  renderMyAppointments();
  showToast("Giriş yapıldı.","ok");
});

/* müşteri çıkış */
btnCustomerLogout.addEventListener("click",()=>{
  currentCustomer=null;
  localStorage.removeItem("atk_currentCustomerPhone");
  updateCustomerUI();
  renderMyAppointments();
  showToast("Müşteri çıkışı yapıldı.","ok");
});

/* admin modal */
btnAdminOpen.addEventListener("click",()=>{
  updateAdminUI();
  adminModalEl.style.display="flex";
});
adminModalClose.addEventListener("click",()=>adminModalEl.style.display="none");

/* admin login */
btnAdminLogin.addEventListener("click",()=>{
  const phone=adminPhoneEl.value.trim();
  const pass=adminPassEl.value.trim();
  if(phone!==ADMIN_PHONE || pass!==ADMIN_PASS){
    showToast("Admin telefon/şifre hatalı.","err");
    return;
  }
  isAdminLogged=true;
  localStorage.setItem("atk_isAdminLogged","1");
  updateAdminUI();
  showToast("Admin girişi başarılı.","ok");
});

/* admin çıkış */
btnAdminLogout.addEventListener("click",()=>{
  isAdminLogged=false;
  localStorage.removeItem("atk_isAdminLogged");
  updateAdminUI();
  adminModalEl.style.display="none";
  showToast("Admin çıkışı yapıldı.","ok");
});

/* admin tabları */
adminTabBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    const target=btn.dataset.adminSection;
    adminTabBtns.forEach(b=>b.classList.remove("active"));
    adminSections.forEach(sec=>sec.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(target).classList.add("active");
  });
});

/* tarih / berber / işlem değişince slotları yenile */
dateInput.addEventListener("change",()=>{
  adminDateFilter.value = dateInput.value;
  renderSlots();
  renderAdminAppointments();
});
servSel.addEventListener("change",()=>renderSlots());
adminDateFilter.addEventListener("change",()=>renderAdminAppointments());
adminBarberFilter.addEventListener("change",()=>renderAdminAppointments());

/* kapalı gün ekleme */
btnAddClosedDate.addEventListener("click",()=>{
  const d=closedDateInput.value;
  if(!d){showToast("Kapalı gün tarihi seç.","err");return;}
  if(!closedDates.includes(d)){
    closedDates.push(d);
    saveClosedDates();
    renderClosedDates();
    renderSlots();
    showToast("Kapalı gün eklendi.","ok");
  }
});

/* hizmet ekleme */
btnAddService.addEventListener("click",()=>{
  const name=newServiceNameEl.value.trim();
  const price=Number(newServicePriceEl.value||0);
  const dur=Number(newServiceDurationEl.value||0);
  if(!name){showToast("Hizmet adı zorunlu.","err");return;}
  if(dur<=0){showToast("Süre dakikasını gir.","err");return;}

  const id="svc-"+Date.now();
  services.push({id,name,price,duration:dur});
  saveServices();
  newServiceNameEl.value="";
  newServicePriceEl.value="";
  newServiceDurationEl.value="";
  renderServicesSelect();
  renderServiceList();
  renderSlots();
  showToast("Hizmet eklendi.","ok");
});

/* berber ekleme (foto istek halinde) */
btnAddBarber.addEventListener("click",()=>{
  const name=newBarberNameEl.value.trim();
  if(!name){showToast("Berber adı gir.","err");return;}
  const file=newBarberPhotoFileEl.files[0];

  const doAdd=(photoData)=>{
    const baseSchedule=[
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:true,  intervals:[{start:"09:00", end:"20:00"}]},
      {active:false, intervals:[]}
    ];
    const id="brb-"+Date.now();
    barbers.push({id,name,photo:photoData||null,schedule:baseSchedule});
    saveBarbers();
    newBarberNameEl.value="";
    newBarberPhotoFileEl.value="";
    renderBarbersUI();
    renderSlots();
    showToast("Berber eklendi.","ok");
  };

  if(file){
    const reader=new FileReader();
    reader.onload=()=>doAdd(reader.result);
    reader.readAsDataURL(file);
  }else{
    doAdd(null);
  }
});

/* randevu kaydet */
btnBook.addEventListener("click",async ()=>{
  if(!currentCustomer){
    showToast("Randevu için önce müşteri girişi yap.","err");
    customerModal.style.display="flex";
    return;
  }

  const name=nameInput.value.trim();
  const phone=phoneInput.value.trim();
  const date=dateInput.value;
  const barberId=barberSel.value;
  const serviceId=servSel.value;
  const time=selectedTime;

  if(!name){showToast("Ad soyad gir.","err");return;}
  if(!validatePhone(phone)){showToast("Telefon formatı 05xxxxxxxxx olmalı.","err");return;}
  if(!date){showToast("Tarih seç.","err");return;}
  if(!barberId){showToast("Berber seç.","err");return;}
  if(!serviceId){showToast("İşlem seç.","err");return;}
  if(!time){showToast("Saat seç.","err");return;}
  if(closedDates.includes(date)){
    showToast("Bu tarih kapalı gün, randevu alınamaz.","err");return;
  }

  const service=services.find(s=>s.id===serviceId);
  const duration=service?service.duration:30;

  const newStart=timeToMin(time);
  const newEnd=newStart+duration;
  const todaysApps = appointments.filter(a=>a.date===date && a.barberId===barberId);
  for(const a of todaysApps){
    if(editingId && a.id===editingId) continue;
    const aStart=timeToMin(a.time);
    const aEnd=aStart+(a.duration||30);
    if(newStart < aEnd && aStart < newEnd){
      showToast("Bu saat seçili işlem süresiyle çakışıyor. Başka saat dene.","err");
      return;
    }
  }

  let app;
  if(editingId){
    const idx=appointments.findIndex(a=>a.id===editingId);
    if(idx===-1){
      editingId=null;
    }else{
      app={...appointments[idx],
        name,phone,date,time,barberId,serviceId,
        duration,
        customerPhone:currentCustomer.phone,
        updatedAt:new Date().toISOString()
      };
      appointments[idx]=app;
    }
  }

  if(!editingId){
    const id="app-"+Date.now();
    app={
      id,
      name,
      phone,
      date,
      time,
      barberId,
      serviceId,
      duration,
      customerPhone:currentCustomer.phone,
      createdAt:new Date().toISOString()
    };
    appointments.push(app);
  }

  editingId=null;
  saveAppointments();
  renderSlots();
  renderMyAppointments();
  renderAdminAppointments();
  renderReports();
  await saveAppointmentToFirestore(app);

  showToast("Randevun kaydedildi.","ok");
});

/* PDF yazdırma */
btnPrintReports.addEventListener("click",()=>{
  adminTabBtns.forEach(b=>b.classList.remove("active"));
  adminSections.forEach(s=>s.classList.remove("active"));
  document.querySelector('.admin-tab[data-admin-section="adminSectionRapor"]').classList.add("active");
  document.getElementById("adminSectionRapor").classList.add("active");
  window.print();
});

btnPrintAppointments.addEventListener("click",()=>{
  adminTabBtns.forEach(b=>b.classList.remove("active"));
  adminSections.forEach(s=>s.classList.remove("active"));
  document.querySelector('.admin-tab[data-admin-section="adminSectionRandevu"]').classList.add("active");
  document.getElementById("adminSectionRandevu").classList.add("active");
  window.print();
});

/* modal arka plana tıklayınca kapatma */
[customerModal, adminModalEl, scheduleModal].forEach(mod=>{
  mod.addEventListener("click",e=>{
    if(e.target===mod){
      mod.style.display="none";
      if(mod===scheduleModal) currentScheduleBarberId=null;
    }
  });
});

/* === INIT === */
function init(){
  loadState();

  const today=new Date();
  const todayStr=today.toISOString().slice(0,10);
  const max = new Date(today.getTime() + MAX_DAYS_AHEAD*24*60*60*1000);
  const maxStr = max.toISOString().slice(0,10);
  dateInput.min=todayStr;
  dateInput.max=maxStr;
  dateInput.value=todayStr;
  adminDateFilter.value=todayStr;

  renderServicesSelect();
  renderServiceList();
  renderBarbersUI();
  renderClosedDates();
  updateCustomerUI();
  updateAdminUI();
  renderSlots();
  renderAdminAppointments();
  renderReports();
  renderMyAppointments();

  loadAppointmentsFromFirestore();
}

init();
</script>
</body>
</html>
