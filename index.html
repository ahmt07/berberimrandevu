<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Ahmet Tekeli Kuaf√∂r ‚Ä¢ Online Randevu</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f172a;
      --card:#111827cc;
      --glass:#111827bf;
      --ink:#f9fafb;
      --muted:#9ca3af;
      --brand:#d4af37;
      --danger:#ef4444;
      --ok:#22c55e;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    html,body{
      height:100%;
      font:15px/1.5 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--ink);
    }

    body{
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px;
    }

    .bg{
      position:fixed;inset:0;z-index:-2;
      background:
        radial-gradient(circle at 0 0,rgba(212,175,55,.28),transparent 45%),
        radial-gradient(circle at 100% 100%,rgba(30,64,175,.55),transparent 45%),
        url("https://images.pexels.com/photos/3993447/pexels-photo-3993447.jpeg?auto=compress&cs=tinysrgb&w=1200") center/cover no-repeat;
      filter:blur(4px) brightness(.5);
      transform:scale(1.03);
    }

    .shell{
      width:100%;
      max-width:420px;
      position:relative;
      margin-top:12px;
    }

    .card-main{
      background:var(--card);
      border-radius:32px;
      box-shadow:0 30px 80px rgba(0,0,0,.7);
      padding:28px 22px 22px;
      border:1px solid rgba(148,163,184,.5);
      position:relative;
      overflow:hidden;
    }

    /* √ºst √ßizgi */
    .card-main::before{
      content:"";
      position:absolute;
      left:24px;right:24px;top:56px;
      height:2px;
      border-radius:999px;
      background:linear-gradient(90deg,#ffffff33,#facc1533,#ffffff33);
    }

    /* Admin butonu */
    .admin-btn{
      position:absolute;
      top:16px;right:18px;
      padding:6px 14px;
      border-radius:999px;
      background:#f9fafb;
      color:#111827;
      font-size:12px;
      font-weight:600;
      border:none;
      box-shadow:0 8px 18px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .admin-btn.hidden{display:none}

    .admin-logout{
      margin-left:6px;
      padding:5px 10px;
      border-radius:999px;
      background:transparent;
      border:1px solid rgba(148,163,184,.7);
      color:var(--muted);
      font-size:11px;
      cursor:pointer;
    }

    /* bell */
    .bell{
      position:absolute;
      top:18px;left:18px;
      width:30px;height:30px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.7);
      background:#111827dd;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      cursor:pointer;
    }
    .bell.hidden{display:none}
    .bell-count{
      position:absolute;
      right:-4px;top:-4px;
      min-width:16px;height:16px;
      border-radius:999px;
      background:var(--danger);
      color:#fff;
      font-size:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0 3px;
    }
    .bell-alert{
      animation:ring .4s ease-in-out 4;
    }
    @keyframes ring{
      0%{transform:rotate(0deg);}
      25%{transform:rotate(-12deg);}
      50%{transform:rotate(8deg);}
      75%{transform:rotate(-6deg);}
      100%{transform:rotate(0deg);}
    }

    /* logo */
    .logo-wrap{
      display:flex;
      justify-content:center;
      margin-top:12px;
      margin-bottom:22px;
    }
    .logo-circle{
      width:92px;height:92px;
      border-radius:999px;
      background:#f9fafb;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 12px 35px rgba(0,0,0,.7);
    }
    .logo-circle img{
      width:80px;height:80px;border-radius:999px;object-fit:cover;
    }

    .title{
      text-align:center;
      margin-bottom:10px;
    }
    .title-main{
      font-size:22px;
      letter-spacing:.22em;
      font-weight:800;
    }
    .title-sub{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--muted);
      margin-top:3px;
    }
    .rating{
      margin-top:8px;
      font-size:12px;
      color:var(--brand);
      display:flex;
      justify-content:center;
      gap:6px;
      align-items:center;
    }
    .rating span:nth-child(2){
      color:var(--brand);
      font-weight:600;
    }
    .rating span:nth-child(3){
      color:var(--muted);
      font-size:11px;
    }

    /* form */
    .form{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    label{
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
      display:block;
    }
    .field{
      display:flex;
      flex-direction:column;
    }
    .field-row{
      display:flex;
      gap:10px;
    }
    .field-row .field{flex:1}

    input,select{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(148,163,184,.8);
      padding:9px 10px;
      font:inherit;
      color:var(--ink);
      background:#020617cc;
      outline:none;
      transition:border-color .15s,box-shadow .15s,background .15s;
    }
    input::placeholder{color:#6b7280}
    input:focus,select:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(212,175,55,.6);
      background:#020617;
    }

    .help-text{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }

    .btn-main{
      margin-top:12px;
      border:none;
      width:100%;
      padding:12px 14px;
      border-radius:999px;
      font-size:14px;
      letter-spacing:.08em;
      font-weight:700;
      text-transform:uppercase;
      background:linear-gradient(90deg,#d4af37,#f59e0b);
      color:#111827;
      box-shadow:0 20px 40px rgba(0,0,0,.6);
      cursor:pointer;
      transition:transform .12s,box-shadow .12s,filter .12s;
    }
    .btn-main:hover{transform:translateY(-1px);filter:brightness(1.04);}
    .btn-main:active{transform:translateY(0);box-shadow:0 10px 25px rgba(0,0,0,.7);}

    .link-row{
      margin-top:10px;
      font-size:11px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .link-btn{
      border:none;
      background:none;
      color:#e5e7eb;
      font-size:11px;
      text-decoration:underline;
      cursor:pointer;
      padding:0;
    }

    /* Admin bug√ºnk√º randevular kartƒ± */
    .admin-today{
      margin-top:14px;
      padding:14px 14px 12px;
      border-radius:22px;
      background:var(--glass);
      border:1px solid rgba(148,163,184,.45);
      box-shadow:0 10px 35px rgba(0,0,0,.65);
    }
    .admin-today.hidden{display:none}
    .admin-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:8px;
    }
    .admin-head-title{
      font-size:13px;
      font-weight:600;
    }
    .chip{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:#020617aa;
    }
    .count-chip{
      margin-left:6px;
      border-color:rgba(34,197,94,.6);
      color:#bbf7d0;
      background:rgba(22,163,74,.25);
    }
    .appt-list{
      list-style:none;
      padding:0;
      margin:0;
      max-height:220px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .appt-item{
      padding:7px 8px;
      border-radius:12px;
      background:#020617cc;
      border:1px solid rgba(31,41,55,.9);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .appt-main{display:flex;flex-direction:column;gap:2px}
    .appt-name{font-weight:600}
    .appt-meta{color:var(--muted);font-size:11px}
    .appt-tag{
      font-size:11px;
      padding:2px 7px;
      border-radius:999px;
      background:rgba(15,23,42,.7);
      border:1px solid rgba(148,163,184,.7);
      align-self:flex-start;
    }
    .empty{
      font-size:12px;
      color:var(--muted);
    }

    /* M√º≈üteri paneli (alt kart) */
    .customer-panel{
      margin-top:12px;
      padding:14px;
      border-radius:20px;
      background:#020617dd;
      border:1px solid rgba(148,163,184,.5);
      box-shadow:0 14px 30px rgba(0,0,0,.7);
      max-width:420px;
      width:100%;
      display:none;
    }
    .customer-panel.active{display:block}
    .customer-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
      font-size:13px;
    }
    .customer-list{
      list-style:none;
      padding:0;margin:6px 0 0;
      max-height:210px;
      overflow:auto;
      display:flex;flex-direction:column;gap:6px;
      font-size:12px;
    }
    .customer-item{
      padding:7px 8px;
      border-radius:10px;
      background:#020617;
      border:1px solid rgba(31,41,55,.9);
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .cancel-btn{
      border:none;
      border-radius:999px;
      padding:3px 8px;
      font-size:11px;
      background:#fee2e2;
      color:#b91c1c;
      cursor:pointer;
    }

    /* TOAST */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%) translateY(120%);
      min-width:220px;
      max-width:320px;
      padding:10px 12px;
      border-radius:999px;
      background:#020617;
      color:#e5e7eb;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 16px 30px rgba(0,0,0,.85);
      opacity:0;
      pointer-events:none;
      transition:transform .25s ease, opacity .25s ease;
      z-index:20;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
      pointer-events:auto;
    }
    .toast-dot{
      width:8px;height:8px;border-radius:999px;
      background:linear-gradient(135deg,#22c55e,#16a34a);
    }
  </style>
</head>
<body>
  <div class="bg"></div>

  <div class="shell">
    <div class="card-main">
      <!-- Bildirim √ßanƒ± (sadece admin) -->
      <div class="bell hidden" id="bell">
        <span>üîî</span>
        <span class="bell-count hidden" id="bellCount">0</span>
      </div>

      <!-- Admin butonlarƒ± -->
      <button class="admin-btn" id="adminLoginBtn">Admin Giri≈üi</button>
      <button class="admin-btn hidden" id="adminBadge">
        Admin
        <button class="admin-logout" id="adminLogoutBtn">√áƒ±kƒ±≈ü</button>
      </button>

      <!-- Logo -->
      <div class="logo-wrap">
        <div class="logo-circle">
          <!-- BURAYA KENDƒ∞ LOGO Lƒ∞NKƒ∞Nƒ∞ KOY -->
          <img src="LOGO_URL_BURAYA" alt="Ahmet Tekeli Logo">
        </div>
      </div>

      <!-- Ba≈ülƒ±k -->
      <div class="title">
        <div class="title-main">AHMET TEKELƒ∞</div>
        <div class="title-sub">ERKEK KUAF√ñR√ú</div>
        <div class="rating">
          <span>‚≠ê</span>
          <span>4.9</span>
          <span>(162)</span>
        </div>
      </div>

      <!-- Form -->
      <form class="form" id="apptForm">
        <div class="field">
          <label for="name">Ad Soyad</label>
          <input id="name" name="name" placeholder="Adƒ±nƒ±z ve Soyadƒ±nƒ±z" required>
        </div>

        <div class="field">
          <label for="phone">Telefon</label>
          <input id="phone" name="phone" inputmode="tel" placeholder="05xxxxxxxxx" required>
        </div>

        <div class="field-row">
          <div class="field">
            <label for="barber">Berber Se√ßimi</label>
            <select id="barber" name="barber" required>
              <option value="">Bir berber se√ßin</option>
            </select>
          </div>
          <div class="field">
            <label for="service">ƒ∞≈ülem Se√ßimi</label>
            <select id="service" name="service" required>
              <option value="">Hizmet se√ßin</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="date">Tarih</label>
          <input id="date" type="date" required>
        </div>

        <div class="field">
          <label for="time">Saat Se√ßimi</label>
          <input id="time" type="time" required>
          <div class="help-text">L√ºtfen bir berber ve tarih se√ßip uygun saati belirleyin.</div>
        </div>

        <button type="submit" class="btn-main">Randevu Al</button>

        <div class="link-row">
          <span>Online randevu ‚Ä¢ Altƒ±noluk</span>
          <button type="button" class="link-btn" id="customerToggle">
            M√º≈üteri Paneli / Randevularƒ±m
          </button>
        </div>
      </form>

      <!-- Admin: bug√ºnk√º randevular -->
      <div class="admin-today hidden" id="adminTodayCard">
        <div class="admin-head">
          <div>
            <div class="admin-head-title">Bug√ºnk√º Randevular</div>
            <div id="todayLabel" style="font-size:11px;color:var(--muted);margin-top:2px;"></div>
          </div>
          <div>
            <span class="chip" id="todayChip"></span>
            <span class="chip count-chip" id="todayCount">0 randevu</span>
          </div>
        </div>
        <ul class="appt-list" id="apptList">
          <li class="empty">Bug√ºn i√ßin kayƒ±tlƒ± randevu yok.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- M√º≈üteri Paneli -->
  <section class="customer-panel" id="customerPanel">
    <div class="customer-header">
      <div id="custTitle">M√º≈üteri Giri≈üi</div>
      <button class="link-btn" id="custLogoutBtn" style="font-size:11px;">√áƒ±kƒ±≈ü</button>
    </div>

    <div id="custLoginArea">
      <div class="field">
        <label for="custPhone">Telefon Numaranƒ±z</label>
        <input id="custPhone" placeholder="05xxxxxxxxx">
      </div>
      <div class="field" style="margin-top:6px;">
        <label for="custPin">4 Haneli ≈ûifre (kendin belirle)</label>
        <input id="custPin" maxlength="4" inputmode="numeric" placeholder="√ñr: 4455">
      </div>
      <button id="custLoginBtn" class="btn-main" style="margin-top:10px;font-size:13px;padding:9px 12px;">Giri≈ü Yap / Kayƒ±t Ol</button>
      <p class="help-text" style="margin-top:6px;">
        Aynƒ± telefonu ve ≈üifreyi kullanarak daha sonra tekrar girip randevularƒ±nƒ±zƒ± g√∂rebilirsiniz.
      </p>
    </div>

    <div id="custListArea" style="display:none;">
      <p style="font-size:12px;color:var(--muted);margin-bottom:4px;">
        Yakla≈üan randevularƒ±nƒ±z:
      </p>
      <ul class="customer-list" id="custList">
        <li class="empty">Kayƒ±tlƒ± randevunuz yok.</li>
      </ul>
    </div>
  </section>

  <!-- Toast -->
  <div class="toast" id="toast">
    <span class="toast-dot"></span>
    <span id="toastMsg">Mesaj</span>
  </div>

  <!-- Firebase & App -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc,
      query,
      where,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js";

    // === Firebase config (senin projen) ===
    const firebaseConfig = {
      apiKey: "AIzaSyAu1Uet9M0o2g44d4VIMyC_etWN7F2XKrI",
      authDomain: "benim-berberim-8e717.firebaseapp.com",
      projectId: "benim-berberim-8e717",
      storageBucket: "benim-berberim-8e717.firebasestorage.app",
      messagingSenderId: "223932865229",
      appId: "1:223932865229:web:91b099ff105aa77164a784",
      measurementId: "G-8MKWHR4DYS"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db  = getFirestore(app);

    // === Yardƒ±mcƒ± ===
    const $ = (id)=>document.getElementById(id);

    const apptForm      = $("apptForm");
    const barberSel     = $("barber");
    const serviceSel    = $("service");
    const dateInput     = $("date");
    const apptListEl    = $("apptList");
    const todayLabelEl  = $("todayLabel");
    const todayChipEl   = $("todayChip");
    const todayCountEl  = $("todayCount");
    const toastEl       = $("toast");
    const toastMsgEl    = $("toastMsg");
    const adminLoginBtn = $("adminLoginBtn");
    const adminBadge    = $("adminBadge");
    const adminLogoutBtn= $("adminLogoutBtn");
    const adminTodayCard= $("adminTodayCard");
    const bellEl        = $("bell");
    const bellCountEl   = $("bellCount");
    const customerToggle= $("customerToggle");
    const customerPanel = $("customerPanel");
    const custTitleEl   = $("custTitle");
    const custLogoutBtn = $("custLogoutBtn");
    const custLoginArea = $("custLoginArea");
    const custListArea  = $("custListArea");
    const custPhoneEl   = $("custPhone");
    const custPinEl     = $("custPin");
    const custLoginBtn  = $("custLoginBtn");
    const custListEl    = $("custList");

    let isAdmin = false;
    let todayUnsub = null;
    let lastTodayCount = 0;
    let unseenCount = 0;

    function todayKey(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${yyyy}-${mm}-${dd}`;
    }
    function formatDateTR(date){
      return date.toLocaleDateString("tr-TR",{
        day:"numeric",month:"long",weekday:"long"
      });
    }
    function showToast(msg){
      toastMsgEl.textContent = msg;
      toastEl.classList.add("show");
      setTimeout(()=>toastEl.classList.remove("show"),2300);
    }

    // Tarih alanƒ±nƒ± bug√ºn yap
    dateInput.value = todayKey();

    // Varsayƒ±lan berber & hizmetler (istersen Firestore ile de doldurabiliriz)
    const defaultBarbers = ["Ahmet Tekeli","Berber 2","Berber 3"];
    const defaultServices= ["Sa√ß Kesim","Sakal Tƒ±ra≈üƒ±","Sa√ß + Sakal","√áocuk Kesim"];
    function fillStaticOptions(){
      defaultBarbers.forEach(name=>{
        const o=document.createElement("option");
        o.value=name;o.textContent=name;
        barberSel.appendChild(o);
      });
      defaultServices.forEach(name=>{
        const o=document.createElement("option");
        o.value=name;o.textContent=name;
        serviceSel.appendChild(o);
      });
    }
    fillStaticOptions();

    // === Admin UI ===
    function updateBellUI(){
      if(!isAdmin){
        bellEl.classList.add("hidden");
        bellCountEl.classList.add("hidden");
        bellEl.classList.remove("bell-alert");
        return;
      }
      bellEl.classList.remove("hidden");
      if(unseenCount>0){
        bellCountEl.textContent = unseenCount;
        bellCountEl.classList.remove("hidden");
        bellEl.classList.add("bell-alert");
      }else{
        bellCountEl.classList.add("hidden");
        bellEl.classList.remove("bell-alert");
      }
    }
    function setAdmin(state){
      isAdmin = state;
      if(state){
        adminLoginBtn.classList.add("hidden");
        adminBadge.classList.remove("hidden");
        adminTodayCard.classList.remove("hidden");
        localStorage.setItem("berber_isAdmin","1");
        startTodayListener();
      }else{
        adminLoginBtn.classList.remove("hidden");
        adminBadge.classList.add("hidden");
        adminTodayCard.classList.add("hidden");
        localStorage.removeItem("berber_isAdmin");
        unseenCount=0;
        if(todayUnsub) todayUnsub();
      }
      updateBellUI();
    }

    // localStorage'dan admin durumu
    if(localStorage.getItem("berber_isAdmin")==="1"){
      setAdmin(true);
    }

    adminLoginBtn.addEventListener("click",()=>{
      const pass = prompt("Admin ≈üifresi:");
      if(pass==="ahmetgs"){
        setAdmin(true);
        showToast("Admin giri≈üi ba≈üarƒ±lƒ±");
      }else if(pass){
        showToast("Hatalƒ± ≈üifre");
      }
    });
    adminLogoutBtn.addEventListener("click",()=>{
      setAdmin(false);
      showToast("Admin √ßƒ±kƒ±≈ü yapƒ±ldƒ±");
    });
    bellEl.addEventListener("click",()=>{
      unseenCount=0;
      updateBellUI();
    });

    // === Bug√ºnk√º randevular dinleyici ===
    function renderToday(list){
      apptListEl.innerHTML="";
      if(!list.length){
        const li=document.createElement("li");
        li.className="empty";
        li.textContent="Bug√ºn i√ßin kayƒ±tlƒ± randevu yok.";
        apptListEl.appendChild(li);
      }else{
        list.forEach(r=>{
          const li=document.createElement("li");
          li.className="appt-item";
          li.innerHTML=`
            <div class="appt-main">
              <div class="appt-name">${r.name||"M√º≈üteri"}</div>
              <div class="appt-meta">
                ${r.time||"-"} ‚Ä¢ ${r.phone||"-"} ‚Ä¢ ${r.barber||"-"}
              </div>
            </div>
            <div class="appt-tag">${r.service||"Hizmet"}</div>
          `;
          apptListEl.appendChild(li);
        });
      }
      todayCountEl.textContent = `${list.length} randevu`;
    }

    function startTodayListener(){
      if(todayUnsub) todayUnsub();
      const q = query(
        collection(db,"appointments"),
        where("date","==",todayKey())
      );
      todayUnsub = onSnapshot(q,(snap)=>{
        const items=[];
        snap.forEach(d=>{
          items.push({id:d.id,...d.data()});
        });
        items.sort((a,b)=>(a.time||"").localeCompare(b.time||""));
        const diff = items.length - lastTodayCount;
        if(isAdmin && diff>0){
          unseenCount += diff;
          updateBellUI();
          showToast("Yeni randevu geldi");
        }
        lastTodayCount = items.length;
        renderToday(items);
      },(err)=>{
        console.error(err);
        showToast("Randevular y√ºklenemedi");
      });
    }

    // Ba≈ülangƒ±√ßta bug√ºn bilgisi yaz
    const now=new Date();
    todayLabelEl.textContent = "Bug√ºn: "+formatDateTR(now);
    todayChipEl.textContent  = todayKey();

    if(isAdmin) startTodayListener();

    // === Randevu olu≈ütur ===
    apptForm.addEventListener("submit",async(e)=>{
      e.preventDefault();
      const name  = apptForm.name.value.trim();
      const phone = apptForm.phone.value.trim();
      const barber= barberSel.value;
      const service=serviceSel.value;
      const date  = dateInput.value;
      const time  = $("time").value;

      if(!name||!phone||!barber||!service||!date||!time){
        showToast("L√ºtfen t√ºm alanlarƒ± doldurun");
        return;
      }

      try{
        await addDoc(collection(db,"appointments"),{
          name,phone,barber,service,date,time,
          createdAt:new Date().toISOString()
        });
        showToast("Randevunuz alƒ±ndƒ± ‚úî");
      }catch(err){
        console.error(err);
        showToast("Randevu kaydedilemedi");
      }
    });

    // === M√º≈üteri paneli (telefon + 4 haneli ≈üifre, localStorage kalƒ±cƒ±) ===
    function getCustomer(){
      const phone=localStorage.getItem("cust_phone");
      const pin  =localStorage.getItem("cust_pin");
      if(phone&&pin) return {phone,pin};
      return null;
    }
    function setCustomer(phone,pin){
      localStorage.setItem("cust_phone",phone);
      localStorage.setItem("cust_pin",pin);
    }
    function clearCustomer(){
      localStorage.removeItem("cust_phone");
      localStorage.removeItem("cust_pin");
    }

    async function loadCustomerAppointments(phone){
      try{
        const q = query(
          collection(db,"appointments"),
          where("phone","==",phone)
        );
        const snap = await getDocs(q);
        const rows=[];
        snap.forEach(d=>rows.push({id:d.id,...d.data()}));

        // Bug√ºnden sonrasƒ±
        const today = todayKey();
        rows.sort((a,b)=> (a.date+a.time).localeCompare(b.date+b.time));
        const upcoming = rows.filter(r=> r.date >= today);

        custListEl.innerHTML="";
        if(!upcoming.length){
          const li=document.createElement("li");
          li.className="empty";
          li.textContent="Yakla≈üan randevunuz bulunmuyor.";
          custListEl.appendChild(li);
        }else{
          upcoming.forEach(r=>{
            const li=document.createElement("li");
            li.className="customer-item";
            li.innerHTML=`
              <div>
                <div style="font-weight:600;">${r.date} ‚Ä¢ ${r.time}</div>
                <div style="font-size:11px;color:#9ca3af;">
                  ${r.service||""} ‚Ä¢ ${r.barber||""}
                </div>
              </div>
              <button class="cancel-btn" data-id="${r.id}">ƒ∞ptal</button>
            `;
            custListEl.appendChild(li);
          });
        }
      }catch(err){
        console.error(err);
        showToast("Randevularƒ±nƒ±z getirilemedi");
      }
    }

    custListEl.addEventListener("click",async(e)=>{
      const btn=e.target.closest(".cancel-btn");
      if(!btn) return;
      if(!confirm("Bu randevu iptal edilsin mi?")) return;
      try{
        await deleteDoc(doc(db,"appointments",btn.dataset.id));
        showToast("Randevu iptal edildi");
        const c=getCustomer();
        if(c) loadCustomerAppointments(c.phone);
      }catch(err){
        console.error(err);
        showToast("ƒ∞ptal edilemedi");
      }
    });

    function showCustomerLogged(phone){
      custTitleEl.textContent = "Randevularƒ±m ‚Ä¢ "+phone;
      custLoginArea.style.display="none";
      custListArea.style.display="block";
      custLogoutBtn.style.display="inline";
    }
    function showCustomerLoggedOut(){
      custTitleEl.textContent = "M√º≈üteri Giri≈üi";
      custLoginArea.style.display="block";
      custListArea.style.display="none";
      custLogoutBtn.style.display="none";
    }

    const existingCust = getCustomer();
    if(existingCust){
      customerPanel.classList.add("active");
      showCustomerLogged(existingCust.phone);
      loadCustomerAppointments(existingCust.phone);
    }else{
      showCustomerLoggedOut();
    }

    customerToggle.addEventListener("click",()=>{
      customerPanel.classList.toggle("active");
    });

    custLoginBtn.addEventListener("click",()=>{
      const phone = custPhoneEl.value.trim();
      const pin   = custPinEl.value.trim();
      if(!phone||!pin||pin.length!==4){
        showToast("Telefon ve 4 haneli ≈üifre girin");
        return;
      }
      setCustomer(phone,pin);
      showToast("Giri≈ü ba≈üarƒ±lƒ±");
      showCustomerLogged(phone);
      loadCustomerAppointments(phone);
    });

    custLogoutBtn.addEventListener("click",()=>{
      clearCustomer();
      showCustomerLoggedOut();
      custListEl.innerHTML='<li class="empty">Kayƒ±tlƒ± randevunuz yok.</li>';
      showToast("M√º≈üteri √ßƒ±kƒ±≈üƒ± yapƒ±ldƒ±");
    });
  </script>
</body>
</html>
